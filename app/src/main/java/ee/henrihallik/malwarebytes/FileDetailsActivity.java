package ee.henrihallik.malwarebytes;

import android.app.Activity;
import android.net.Uri;
import android.os.Bundle;
import android.widget.ImageView;
import android.widget.TextView;

import com.bumptech.glide.Glide;

import java.io.File;
import java.io.IOException;
import java.net.URLConnection;
import java.nio.file.Files;
import java.nio.file.attribute.BasicFileAttributes;

public class FileDetailsActivity extends Activity {
    public static final String KEY_FULL_FILE_PATH = "full_file_path";

    public void onCreate(Bundle savedInstanceState){
        super.onCreate(savedInstanceState);
        setContentView(R.layout.activity_file_details);
        String path = getIntent().getExtras().getString(KEY_FULL_FILE_PATH);

        File file = new File(path);

        TextView fileNameTextView = findViewById(R.id.fileNameTextView);
        fileNameTextView.setText(path);

        BasicFileAttributes attr = null;
        try {
            attr = Files.readAttributes(file.toPath(), BasicFileAttributes.class);

            TextView createdAtTV = findViewById(R.id.createdAtTv);
            createdAtTV.setText(getString(R.string.created_at, attr.creationTime().toString()));

            TextView lastModifiedTV = findViewById(R.id.lastModifiedTV);
            lastModifiedTV.setText(getString(R.string.last_modified, attr.lastModifiedTime().toString()));

            TextView fileSizeTV = findViewById(R.id.fileSizeTV);
            fileSizeTV.setText(getString(R.string.file_size, ((double)attr.size())/1024));

            //https://stackoverflow.com/questions/34443171/load-image-from-sd-card-using-glide
            if(isImageFile(path)){
                Uri imageUri = Uri.fromFile(file);
                ImageView imageView = findViewById(R.id.imageView);
                Glide.with(this)
                        .load(imageUri)
                        .into(imageView);
            }
        } catch (IOException e) {
            e.printStackTrace();
        }
    }

    //https://stackoverflow.com/questions/17618118/check-if-a-file-is-an-image-or-a-video
    public boolean isImageFile(String path) {
        String mimeType = URLConnection.guessContentTypeFromName(path);
        return mimeType != null && mimeType.startsWith("image");
    }
}
